{% extends "base.html" %}

{% block title %}系統錯誤 - 英文單字筆記本{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center align-items-center" style="min-height: 60vh;">
        <div class="col-md-6 text-center">
            <div class="error-page">
                <!-- 500 圖示 -->
                <div class="mb-4">
                    <i class="bi bi-exclamation-octagon-fill text-danger" style="font-size: 5rem;"></i>
                </div>

                <!-- 錯誤標題 -->
                <h1 class="display-1 fw-bold text-danger mb-3">500</h1>
                <h2 class="h4 mb-3">系統發生錯誤</h2>

                <!-- 錯誤說明 -->
                <p class="text-muted mb-4">
                    抱歉，伺服器發生了內部錯誤，無法完成您的請求。<br>
                    我們的技術團隊已經收到通知，正在努力修復這個問題。
                </p>

                <!-- 建議操作 -->
                <div class="mb-4">
                    <h5>您可以嘗試：</h5>
                    <ul class="list-unstyled text-muted">
                        <li><i class="bi bi-arrow-clockwise text-info me-2"></i>重新整理頁面</li>
                        <li><i class="bi bi-clock text-info me-2"></i>稍等幾分鐘後再試</li>
                        <li><i class="bi bi-house text-info me-2"></i>返回首頁重新開始</li>
                        <li><i class="bi bi-wifi text-info me-2"></i>檢查網路連線狀態</li>
                    </ul>
                </div>

                <!-- 操作按鈕 -->
                <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center">
                    <button onclick="window.location.reload()" class="btn btn-info btn-lg">
                        <i class="bi bi-arrow-clockwise"></i> 重新整理
                    </button>
                    <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg">
                        <i class="bi bi-house"></i> 返回首頁
                    </a>
                </div>

                <!-- 技術資訊 -->
                <div class="mt-5 pt-4 border-top">
                    <details class="text-start">
                        <summary class="text-muted small mb-2" style="cursor: pointer;">
                            <i class="bi bi-info-circle"></i> 技術資訊
                        </summary>
                        <div class="bg-light p-3 rounded small text-muted">
                            <strong>錯誤時間:</strong> <span id="errorTime"></span><br>
                            <strong>頁面位址:</strong> <span id="errorUrl"></span><br>
                            <strong>瀏覽器:</strong> <span id="userAgent"></span><br>
                            <strong>錯誤代碼:</strong> HTTP 500 Internal Server Error
                        </div>
                    </details>
                </div>

                <!-- 聯絡資訊 -->
                <div class="mt-4">
                    <p class="text-muted small">
                        如果問題持續發生，您可以：<br>
                        <i class="bi bi-envelope"></i> 回報問題給開發團隊<br>
                        <i class="bi bi-github"></i> 在 GitHub 上提交 Issue
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 背景裝飾 -->
<style>
.error-page {
    position: relative;
    z-index: 1;
}

.error-page::before {
    content: '';
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 200px;
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(253, 126, 20, 0.1) 100%);
    border-radius: 50%;
    z-index: -1;
}

.btn-lg {
    padding: 0.75rem 2rem;
    font-size: 1.1rem;
}

details summary {
    list-style: none;
}

details summary::-webkit-details-marker {
    display: none;
}

details[open] summary::after {
    content: ' ▼';
}

details summary::after {
    content: ' ▶';
}

@media (max-width: 576px) {
    .display-1 {
        font-size: 4rem;
    }

    .bi-exclamation-octagon-fill {
        font-size: 3rem !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// 填入技術資訊
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('errorTime').textContent = new Date().toLocaleString('zh-TW');
    document.getElementById('errorUrl').textContent = window.location.href;
    document.getElementById('userAgent').textContent = navigator.userAgent.split(' ').slice(-2).join(' ');
});

// 記錄 500 錯誤
console.error('500 Error: Internal Server Error -', window.location.href);

// 自動重試機制（可選）
let retryCount = 0;
const maxRetries = 3;

function autoRetry() {
    if (retryCount < maxRetries) {
        retryCount++;
        console.log(`自動重試 ${retryCount}/${maxRetries}`);

        setTimeout(() => {
            window.location.reload();
        }, 5000 * retryCount); // 遞增延遲時間
    }
}

// 如果需要自動重試，可以取消註解以下代碼
// autoRetry();

// 提供回報錯誤功能
function reportError() {
    const errorInfo = {
        timestamp: new Date().toISOString(),
        url: window.location.href,
        userAgent: navigator.userAgent,
        errorType: '500 Internal Server Error'
    };

    // 這裡可以發送錯誤報告到後端
    console.log('Error Report:', errorInfo);

    // 或者複製到剪貼板
    navigator.clipboard.writeText(JSON.stringify(errorInfo, null, 2)).then(() => {
        alert('錯誤資訊已複製到剪貼板');
    }).catch(() => {
        alert('無法複製錯誤資訊');
    });
}

// 添加回報按鈕（可選）
/*
const reportBtn = document.createElement('button');
reportBtn.className = 'btn btn-outline-warning btn-sm mt-2';
reportBtn.innerHTML = '<i class="bi bi-bug"></i> 回報錯誤';
reportBtn.onclick = reportError;
document.querySelector('.error-page').appendChild(reportBtn);
*/
</script>
{% endblock %}